{% extends 'base.html' %}
{% load static %}
{% block content %}
<h1 style="text-align: left;">검색 결과</h1>

<h3>정보 게시판</h3>
<ol id="info-posts">
</ol>

<h3>리뷰 게시판</h3>
<ol id="user-posts">
</ol>

<script>
    // 검색어를 포함하여 Axios 요청을 보내 검색 결과를 가져오는 함수
    function fetchSearchResults(searchQuery) {
        const searchUrl = `http://127.0.0.1:8000/api/post/search/?q=${searchQuery}`; // 검색 URL
        
        axios.get(searchUrl)
            .then(response => {
                console.log(response.data)
                const infoPosts = response.data.info;
                const userPosts = response.data.review;

                // 정보 게시판 업데이트
                const infoPostsList = document.getElementById("info-posts");
                if (!infoPosts) {
                    const noResultsMessage = document.createElement("p");
                    noResultsMessage.textContent = "결과가 없습니다.";
                    infoPostsList.appendChild(noResultsMessage);
                } else {
                    infoPosts.forEach(post => {
                        const listItem = document.createElement("li");
                        const link = document.createElement("a");
                        link.href = `/post/${post.id}`;
                        link.textContent = post.title;
                        listItem.appendChild(link);
                        infoPostsList.appendChild(listItem);
                    });
                }

                // 리뷰 게시판 업데이트
                const userPostsList = document.getElementById("user-posts");
                if (!userPosts) {
                    const noResultsMessage = document.createElement("p");
                    noResultsMessage.textContent = "결과가 없습니다.";
                    userPostsList.appendChild(noResultsMessage);
                } else {
                    userPosts.forEach(post => {
                        const listItem = document.createElement("li");
                        const link = document.createElement("a");
                        link.href = `/post/${post.id}`;
                        link.textContent = post.title;
                        listItem.appendChild(link);
                        userPostsList.appendChild(listItem);
                    });
                }
            })
            .catch(error => {
                console.error("검색 결과를 가져오는 동안 오류가 발생했습니다:", error);
            });
    }

    // 페이지 로드 시 검색 결과를 가져옵니다
    const searchQuery = "{{ q }}";
    fetchSearchResults(searchQuery);
</script>
{% endblock content %}
