{% extends 'base.html' %}
{% load static %}
{% load crispy_forms_tags %}
{% block content %}
<div>
    <h1 style="text-align: left;">리뷰 게시판</h1>
    <button type="button" onclick="window.location.href='{% url 'web:post_create' %}'">글 작성</button>
    <ul id="post-list">
    </ul>
    <nav aria-label="Page navigation" style="display: flex; justify-content: space-between;">
        <div class="pagination" id="pagination-prev" style="padding-left: 200px;">
        </div>
        <div class="pagination" id="pagination">
        </div>
        <div class="pagination" id="pagination-next" style="padding-right: 200px;">
        </div>
    </nav>
</div>

<script>
let currentPage = 1; // 현재 페이지 초기값

function loadPosts(url) {
    axios.get(url)
        .then(response => {
            const posts = response.data;
            const postList = document.getElementById('post-list');
            const paginationPrev = document.getElementById('pagination-prev');
            const pagination = document.getElementById('pagination');
            const paginationNext = document.getElementById('pagination-next');

            // 게시물 목록 업데이트
            postList.innerHTML = '';
            posts.results.forEach(post => {
                const listItem = document.createElement('li');
                const link = document.createElement('a');
                link.href = `/post/${post.id}/`;
                link.textContent = post.title;
                listItem.appendChild(link);
                postList.appendChild(listItem);
            });

            // 페이지네이션 업데이트
            paginationPrev.innerHTML = '';
            pagination.innerHTML = '';
            paginationNext.innerHTML = '';
            if (posts.previous) {
                const previousLi = document.createElement('li');
                const previousLink = document.createElement('a');
                previousLink.href = '#';
                previousLink.textContent = 'Previous';
                previousLink.addEventListener('click', () => {
                    loadPosts(posts.previous);
                });
                previousLi.appendChild(previousLink);
                paginationPrev.appendChild(previousLi);
            }
            if (posts.next) {
                const nextLi = document.createElement('li');
                const nextLink = document.createElement('a');
                nextLink.href = '#';
                nextLink.textContent = 'Next';
                nextLink.addEventListener('click', () => {
                    loadPosts(posts.next);
                });
                nextLi.appendChild(nextLink);
                paginationNext.appendChild(nextLi);
            }
        })
        .catch(error => {
            console.error('게시물을 불러오는 중 오류가 발생했습니다:', error);
        });
}

loadPosts("{% url 'post:post_list' category=category %}?page={{ posts.number }}");

document.addEventListener("DOMContentLoaded", function () {
            const username = localStorage.getItem("username");
            if (username) {
                document.getElementById("logout-button").style.display = "block";
            }
            else {
                document.getElementById("login-button").style.display = "block";
                document.getElementById("signup-button").style.display = "block";
            }
        });

</script>
{% endblock content %}
