<style>
    .pagination {
        display: flex;
        justify-content: center;
    }
</style>

{% extends 'base.html' %}
{% load static %}
{% load crispy_forms_tags %}
{% block content %}
<div>
    <h1 style="text-align: left;">리뷰 게시판</h1>
    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#postModal">
        글 작성하기
    </button>
    <ul id="post-list">
    </ul>
    <nav aria-label="Page navigation" style="display: flex; justify-content: space-between;">
        <div class="pagination" id="pagination-prev" style="padding-left: 200px;">
        </div>
        <div class="pagination" id="pagination">
        </div>
        <div class="pagination" id="pagination-next" style="padding-right: 200px;">
        </div>
    </nav>
</div>

<!-- 글 작성용 모달 창 -->
<div class="modal fade" id="postModal" tabindex="-1" role="dialog" aria-labelledby="postModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="postModalLabel">글 작성하기</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="postForm" enctype="multipart/form-data">
                    {% csrf_token %}
                    {{ form | crispy }}
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">닫기</button>
                <button type="button" class="btn btn-primary" onclick="submitForm()">저장</button>
            </div>
        </div>
    </div>
</div>

<script>
let currentPage = 1; // 현재 페이지 초기값

function loadPosts(url) {
    axios.get(url)
        .then(response => {
            const posts = response.data;
            const postList = document.getElementById('post-list');
            const paginationPrev = document.getElementById('pagination-prev');
            const pagination = document.getElementById('pagination');
            const paginationNext = document.getElementById('pagination-next');

            // 게시물 목록 업데이트
            postList.innerHTML = '';
            posts.results.forEach(post => {
                const listItem = document.createElement('li');
                const link = document.createElement('a');
                link.href = `/post/${post.id}/`;
                link.textContent = post.title;
                listItem.appendChild(link);
                postList.appendChild(listItem);
            });

            // 페이지네이션 업데이트
            paginationPrev.innerHTML = '';
            pagination.innerHTML = '';
            paginationNext.innerHTML = '';
            if (posts.previous) {
                const previousLi = document.createElement('li');
                const previousLink = document.createElement('a');
                previousLink.href = '#';
                previousLink.textContent = 'Previous';
                previousLink.addEventListener('click', () => {
                    loadPosts(posts.previous);
                });
                previousLi.appendChild(previousLink);
                paginationPrev.appendChild(previousLi);
            }
            if (posts.next) {
                const nextLi = document.createElement('li');
                const nextLink = document.createElement('a');
                nextLink.href = '#';
                nextLink.textContent = 'Next';
                nextLink.addEventListener('click', () => {
                    loadPosts(posts.next);
                });
                nextLi.appendChild(nextLink);
                paginationNext.appendChild(nextLi);
            }
        })
        .catch(error => {
            console.error('게시물을 불러오는 중 오류가 발생했습니다:', error);
        });
}

// 페이지 로드
loadPosts("{% url 'post:post_list' category=category %}?page={{ posts.number }}");

// 글 작성 폼을 서버로 전송하는 함수
function submitForm() {
    const formData = new FormData(document.getElementById('postForm'));
    axios.post("/api/post/", formData)
        .then(response => {
            // 처리할 내용을 여기에 작성하세요
            $('#postModal').modal('hide'); // 모달 닫기
            location.reload(); // 페이지 리로드
        })
        .catch(error => {
            console.error('에러 발생:', error);
        });
}
</script>
{% endblock content %}
